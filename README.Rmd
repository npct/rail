---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  cache = TRUE,
  collapse = TRUE,
  comment = "#>",
  # eval = FALSE,
  echo = FALSE
)
library(tidyverse)

param_region = "west-yorkshire"
param_min_flow = 100
param_min_flow_rail = 30
```

# Estimating cycling potential to rail stations

<!-- badges: start -->
[![.github/workflows/render-rmarkdown.yaml](https://github.com/npct/rail/actions/workflows/render-rmarkdown.yaml/badge.svg)](https://github.com/npct/rail/actions/workflows/render-rmarkdown.yaml)
<!-- badges: end -->

The goal of this repo is to explore methods for calculating cycling potential to public transport nodes, rail stations in the first instance.

# OD data

The input data consists of origin-destination pairs.
These can be obtained from a range of sources.
We will use open OD data from the 2011 UK Census to demonstrate the methods.
A random sample of OD pairs from the national dataset is shown below.

```{r}
od_england_wales = pct::get_od()
centroids_england_wales = pct::get_centroids_ew() %>% 
  sf::st_transform(4326)
od_england_wales %>% 
  sample_n(3) %>% 
  knitr::kable()
```

The case study region of West Yorkshire is used to subset the data.
OD pairs with more than 50 people by any mode and with more than 50 people travelling by rail are shown below.

```{r}
region = pct::pct_regions %>% 
  filter(region_name == param_region)
centroids_region = centroids_england_wales[region, ]
od_region = od_england_wales %>% 
  filter(geo_code1 %in% centroids_region$msoa11cd)
od_filtered = od_region %>% 
  filter(all >= param_min_flow_rail)
desire_filtered = od::od_to_sf(x = od_filtered, z = centroids_england_wales)
desire_rail = desire_filtered %>% 
  filter(train >= param_min_flow_rail)
plot(region$geometry)
plot(centroids_england_wales$geometry, add = TRUE)
plot(centroids_region$geometry, pch = 2, add = TRUE)
plot(desire_filtered$geometry, add = TRUE, lwd = 0.2)
plot(desire_rail$geometry, add = TRUE, col = "blue")
```

# Rail station data

```{r, eval=FALSE}
u_naptan = "http://naptan.app.dft.gov.uk/DataRequest/Naptan.ashx?format=csv"
f_naptan = basename(u_naptan)
download.file(url = u_naptan, destfile = f_naptan)
unzip(f_naptan)
list.files()
rail_naptan = readr::read_csv("RailReferences.csv")
rail_sf = sf::st_as_sf(rail_naptan, coords = c("Easting", "Northing"), crs = 27700) %>% 
  sf::st_transform(4326)
plot(region$geometry)

```



# Transit routing



# Discussion
